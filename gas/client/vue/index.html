<template id="app">
  <v-app>
    <v-container>
      <v-row>
        <v-col>
          <v-card>
            <v-data-table
              :headers="headerPatterns"
              :items="patternsRegExp"
              :items-per-page="200"
              dense
            >
            </v-data-table>
          </v-card>
        </v-col>
        <v-col>
          <v-card>
            <v-card-title>
              test
            </v-card-title>
            <v-text-field label="パターン(正規表現)" v-model="newRegExp"></v-text-field>
            <v-text-field label="説明" v-model="newText"></v-text-field>
            <v-text-field label="品目" v-model="newHinmoku"></v-text-field>
            <v-btn @click="onRegisterRegExp"></v-btn>
          </v-card>
        </v-col>
      </v-row>
      <v-row>
        <v-col>
          <v-card>
            <v-card-title>
              個品テーブル
              <v-spacer></v-spacer>
              <v-text-field
                v-model="searchKohin"
                append-icon="search"
                label="Search"
                single-line
                hide-details
              ></v-text-field>
            </v-card-title>
            <v-file-input type="file" @change="onFileChange($event)"></v-file-input>
            <v-btn @click="onSave" >Save</v-btn>
            <v-data-table
              :headers="headerRecords"
              :items="recordsMatching.slice(0,100000)"
              :items-per-page="200"
              @click:row="console.log('eee')"
              :search="searchKohin"
              dense
            ></v-data-table>
          </v-card>
        </v-col>
      </v-row>
      <v-row>
        <v-col>
          <v-card>
            <v-card-title>
              品目一覧
              <v-spacer></v-spacer>
              <v-text-field
                v-model="searchHinmoku"
                append-icon="search"
                label="Search"
                single-line
                hide-details
              ></v-text-field>
            </v-card-title>
            <v-file-input type="file" @change="onFileChangeHinmoku"></v-file-input>
            <v-btn @click="onSave" >Save</v-btn>
            <v-data-table
              :headers="headerHinmoku"
              :items="hinmoku"
              :items-per-page="200"
              :search="searchHinmoku"
              dense
            ></v-data-table>
          </v-card>
        </v-col>
      </v-row>
    </v-container>
  </v-app>
</template>

<script>

const App = {
  template: '#app',


  data() {
    return {
      newRegExp: "",
      newText: "",
      newHinmoku: "",
      searchHinmoku:"",
      searchKohin:"",
    }
  },

  computed: {
    ...Vuex.mapGetters([
      'recordsMatching',
      'patternsRegExp',
    ]),
    ...Vuex.mapState([
      'headerRecords',
      'headerPatterns',
      'headerHinmoku',
      'hinmoku',
    ]),
  },
  methods: {
    ...Vuex.mapMutations([
      'addPattern'
    ]),
    onFileChange(e){
      console.log(e)
      var file = e;
      var url = URL.createObjectURL(file);
      console.log(url)
      d3.csv(url)
        .then(myRecords => {
        store.commit('readRecords',myRecords)
      });
    },
    onFileChangeHinmoku(e){
      console.log(e)
      var file = e;
      var url = URL.createObjectURL(file);
      console.log(url)
      d3.csv(url)
        .then(myHinmoku => {
        store.commit('readHinmoku',myHinmoku)
      });
    },
    onSave(e){
      console.log('hozon')
    },
    onRegisterRegExp(){
      const result = this.addPattern({
        regExp: this.newRegExp,
        text: this.newText,
        hinmoku: this.newText,
      })
    }
  }
}

const vue = new Vue({
  store,
  vuetify: new Vuetify(),
  render: h => h(App)
  }).$mount('#vue-app')

</script>
